# container-vulnerability-exporter

The container vulnerability exporter will collect an image inventory from an OpenShift cluster and report on vulnerabilities within those images, providing the resulting data as metrics.

The code here is currently in a development/proof-of-concept/discovery state. The results of this work will be developed into an operator for simplified deployment/management. This code is developed for and tested with OpenShift =>3.11 ([k8s 1.11](https://github.com/openshift/origin/tree/release-3.11/vendor/k8s.io)), but may also work with non-OpenShift k8s clusters.  

## Quickstart

- Clone this repo
- Have an active/authenticated k8s config
- pip install openshift prometheus_client
- ./cluster-cvscanner.py (^C to exit)
- Point prom scraper at localhost:8080  (or just curl http://localhost:8080)
- Enjoy!

# cluster-cvscanner.py
[cluster-cvscanner.py](cluster-cvscanner.py).

## Dependencies
- [OpenShift python client](https://pypi.org/project/openshift/), (=>0.9.2), "pip install openshift"
- [Prometheus python client](https://github.com/prometheus/client_python), (=>0.7.1), "pip install prometheus_client"

## Configuration
- (env) KUBECONFIG {optional}: path to k8s config file; default: "~/.kube/config"
- (env) SKIPNS {optional}, list of namespaces to skip when collecting image data from a cluster; default: "" -- no namespaces will be filtered
- (env) TARGETNS {optional}, list of namespaces to scan for image data from a cluster; default: "" -- all available namespaces will be scanned
- (env) QUAY_TOKEN {required}, quay API token

# TODO / Backlog
## Milestone_0
- [X] PoC: Get images, get vuln data, output as prom-exporter metrics
  - [x] Image gather
  - [x] Vuln data gather
  - [X] Prom exporter
  - [X] Unified script
    - [x] cache
    - [x] lint check
## Milestone_1
- [ ] tests
- [ ] Docker configs
- [ ] Saasherder integration files (service definition, jjb)
- [ ] Skip/Include pods by label
- [ ] Skip system namespaces automatically
- [ ] Metric export, non-quay.io images
- [ ] Metric export, introspection: api calls made (to openshift, to quay), success|failure count, latency of api calls
## Milestone_2
- [ ] Controller/Operator-ize -- go-lang..?
## Milestone_3
- [ ] Non-quay image CVE data?
